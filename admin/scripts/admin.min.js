/*! admin-template 1.0.0 */
var login=function(){var a=$("#login-form"),b=$("#btn-submit");return{init:function(){a[0].reset(),a.validate({errorElement:"span",errorClass:"help-block",focusInvalid:!0,rules:{username:{required:!0},password:{required:!0}},messages:{username:{required:lang.error.username.required},password:{required:lang.error.password.required}},highlight:function(a){$(a).closest(".form-group").addClass("has-error")},success:function(a){a.closest(".form-group").removeClass("has-error"),a.remove()},errorPlacement:function(a,b){a.insertAfter(b.closest(".input-icon"))},submitHandler:function(a){login.submit()}}),$("input",a).keypress(function(b){return 13==b.which?(a.validate().form()&&login.submit(),!1):void 0})},submit:function(){$("#password").val($.md5($("#password").val())),liuxy.ajax(b,"/admin/default/login.json","json",a.serialize(),function(b){message.success(a,{content:lang.success.login}),window.location.href=b},function(b,c){message.error(a,{content:c})},!0)}}}();
var perm=function(){var a="/admin/permission/",b=$("#btn-submit"),c=$(".modal-body"),d=$("#perm-dialog"),e=$("#perm-dialog-title"),f=$("#perm-form"),g=$("#perm-tree"),h=$("#perm-table");return{init:function(){g.jstree({core:{themes:{responsive:!1},check_callback:!0,data:{state:{opened:!1},url:function(b){return baseUrl+a+"ajax.json"},data:function(a){return{parent:a.id}},success:function(a){a=a.perms}}},types:{"default":{icon:"fa fa-folder icon-state-warning icon-lg"},file:{icon:"fa fa-file icon-state-warning icon-lg"}},state:{key:"demo2"},plugins:["contextmenu","state","types"],contextmenu:{items:{create:{label:lang.label.add,icon:"glyphicon glyphicon-plus",action:function(){var a=g.jstree(!0),c=a.get_selected();return c.length?(c=c[0],f[0].reset(),$("#parent_id").val(c.substring("node_".length)),e.html(lang.label.perm.node.add),d.modal(),b.unbind("click"),void b.click(function(){perm.create(a,c)})):!1}},edit:{label:lang.label.edit,separator_before:!0,separator_after:!0,icon:"glyphicon glyphicon-pencil",action:function(){var c=g.jstree(!0),h=c.get_selected();return h.length?(h=h[0],void liuxy.ajax(b,a+"get.json","json",{id:h.substring("node_".length)},function(a){f[0].reset(),$("#name").val(a.name),$("#link").val(a.link),$("#description").val(a.description),$("#parent_id").val(h.substring("node_".length)),e.html(lang.label.perm.node.edit),d.modal(),b.unbind("click"),b.click(function(){perm.update()})},function(a,b){bootbox.alert(b)},!0)):!1}},remove:{label:lang.label["delete"],icon:"glyphicon glyphicon-minus",action:function(){var c=g.jstree(!0),d=c.get_selected();if(!d.length)return!1;d=d[0];var e=d.substring("node_".length);return 1==e?(bootbox.alert(lang.error.perm.root_noperm_delete),!1):void liuxy.ajax(b,a+"delete.json","json",{id:d.substring("node_".length)},function(a){bootbox.alert(lang.success["delete"],function(){perm.refresh()})},function(a,b){bootbox.alert(b)},!0)}}}}});var c=$(".tools a");c.bind("click",function(){var a=$("#goback").val();a&&perm.get(this,a)})},create:function(){liuxy.ajax(b,a+"create.json","json",f.serialize(),function(a){message.success(c,{content:lang.success.add}),perm.refresh()},function(a,b){message.error(c,{content:b})},!0)},update:function(){liuxy.ajax(b,a+"update.json","json",f.serialize(),function(a){message.success(c,{content:lang.success.edit}),perm.refresh()},function(a,b){message.error(c,{content:b})},!0)},refresh:function(){g.jstree(!0).refresh()},get:function(d,e){$("#tools").hide(),liuxy.ajax($(d),a+"ajax","text",{parent:e},function(d){h.html(d),"node_1"!=e&&$("#tools").show(),$("tbody",h).sortable({placeholder:"ui-state-highlight",update:function(d,e){var f=[];$("tr",h).each(function(){f.push($(this).attr("pid"))}),liuxy.ajax(b,a+"seq.json","json",{ids:f.join("_")},function(a){perm.refresh()},function(a,b){message.error(c,{content:b})},!0)}}),$("tbody",h).disableSelection()},function(a,b){message.error(c,{content:b})},!0)}}}();
var role=function(){var a="/admin/role/",b=$("#perm-tree"),c=$("#btn-submit"),d=$("#role-dialog"),e=$("#role-dialog-title"),f=$(".modal-body"),g=$("#role-form"),h={themes:{responsive:!1},check_callback:!0,data:{state:{opened:!0},url:function(b){return baseUrl+a+"perm.json"},data:function(a){return{parent:a.id,id:$("#id").val()}},success:function(a){a=a.perms}}},i={three_state:!1,cascade:""};return{init:function(){jtable.checkbox($("#role-table")),c.click(function(){role.save()}),$("#role-add").click(function(){e.html(lang.label.role.add),g[0].reset(),$("#id").val(""),i.cascade="up+undetermined+down",role.perm(),d.modal()}),d.on("hide.bs.modal",function(a){var c=b.jstree(!0);c&&c.destroy()})},save:function(){var c="",d=b.jstree(!0),e=d.get_checked(!0);$.each(e,function(a,b){c+=$(b).attr("id").substring("node_".length)+","}),b.find(".jstree-undetermined").each(function(){c+=$(this).parent().parent().attr("id").substring("node_".length)+","}),$("#pids").val(c),liuxy.ajax(f,a+"save.json","json",g.serialize(),function(a){message.success(f,{content:lang.success.edit})},function(a,b){message.error(f,{content:b})},!0)},get:function(b){liuxy.ajax(f,a+"get.json","json",{id:b},function(a){$("#id").val(b),$("#name").val(a.name),$("#description").val(a.description),e.html(lang.label.role.edit),d.modal(),i.cascade="up+undetermined",role.perm()},function(a,b){message.error(f,{content:b})},!0)},"delete":function(b){liuxy.ajax($("body"),a+"delete.json","json",{id:b},function(a){bootbox.alert(lang.success["delete"],function(){$("#tr-role-"+b).remove()})},function(a,b){bootbox.alert(b)},!0)},perm:function(){b.jstree({plugins:["checkbox","types"],core:h,types:{"default":{icon:"fa fa-folder icon-state-warning icon-lg"},file:{icon:"fa fa-file icon-state-warning icon-lg"}},checkbox:i})}}}();
var user=function(){var a="/admin/user/",b=$("#btn-submit"),c=$("#user-dialog"),d=$("#user-dialog-title"),e=$(".modal-body"),f=$("#user-form"),g=$("#user-status");return{init:function(){g.val(g.attr("data-value")),b.click(function(){user.save()}),g.change(function(){liuxy.redirect(a.substr(1,a.length-1)+"?status="+g.val())}),$("#user-add").click(function(){d.html(lang.label.user.add),f[0].reset(),$("#id").val(""),$("#username").removeAttr("readonly"),c.modal()})},save:function(){$("#password").val($.md5($("#password").val())),liuxy.ajax(e,a+"save.json","json",f.serialize(),function(a){$("#password").val(""),message.success(e,{content:lang.success.edit})},function(a,b){$("#password").val(""),message.error(e,{content:b})},!0)},get:function(b){liuxy.ajax(e,a+"get.json","json",{id:b},function(a){$("#id").val(b),$("#name").val(a.name),$("#password").val(""),$("#username").val(a.username),$("#username").attr("readonly","realonly"),$("input[name='status']").each(function(){return $(this).val()==a.status?($(this).parent().click(),!1):void 0}),a.roles&&$("input[type='checkbox']").each(function(){var b=$(this);$.each(a.roles,function(a,c){c.role_id==b.val()&&b.parent().click()})}),d.html(lang.label.user.edit),c.modal()},function(a,b){message.error(e,{content:b})},!0)}}}();